<!-- Begin tab selection and point sort order -->

<div
  [ngClass]="{
    show: tabIndex !== Tabs.questionAnswers,
    hide: tabIndex === Tabs.questionAnswers
  }"
  class="amy-2"
>
  <div class="flexRow wrap justify-center">
    <!-- 1. Show tag clouds and tag search -->
    <button
      mat-button
      [class.selected]="tabIndex === Tabs.slashTags"
      (click)="ShowTags()"
      matTooltip="slash-tags"
      matTooltipPosition="above"
    >
      <div class="flexRow align-center smallGap">
        <div class="slash">/</div>
        <div>{{ slashTagsButtonText }}</div>
      </div>
    </button>

    <!-- 2. Select questions -->
    <button
      mat-button
      [class.selected]="
        tabIndex === Tabs.questionList || tabIndex === Tabs.questionAnswers
      "
      (click)="ShowQuestions()"
      matTooltip="show questions"
      matTooltipPosition="above"
    >
      questions
      <mat-icon>help</mat-icon>
    </button>

    <!-- 4. Select points -->
    <button
      mat-button
      (click)="ShowPoints()"
      [class.selected]="tabIndex === Tabs.tagPoints"
      matTooltip="show points"
      matTooltipPosition="above"
    >
      points
      <mat-icon>comment</mat-icon>
    </button>

    <!-- 5. New question answer or tag point  -->
    <button
      mat-button
      *ngIf="auth0Service.isAuthenticated$ | async"
      [class.selected]="tabIndex === Tabs.newPoint"
      (click)="ChangeTab(Tabs.newPoint)"
      [matTooltip]="'create new ' + qp"
      matTooltipPosition="above"
    >
      new {{ qp }}
      <mat-icon>library_add</mat-icon>
    </button>

    <!-- Select menu -->
    <app-select-menu
      [tabIndex]="tabIndex"
      [showFilters]="showFilters"
      [qp]="qp"
      (showFiltersChange)="ShowPointFilterCriteria($event)"
      (feedbackChange)="FeedbackChange($event)"
    ></app-select-menu>

    <!-- Sort Menu -->
    <app-sort-menu
      [pointSortType]="filter.sortType"
      [sortDescending]="filter.sortDescending"
      (pointSortTypeChange)="SetSortType($event)"
      (sortDescendingChange)="SetSortDescending($event)"
      (refresh)="refresh()"
    ></app-sort-menu>

    <!-- Local Topics -->
    <button
      mat-button
      (click)="ChangeConstituency()"
      class="localButton"
      [class.selected]="localData.ConstituencyID > 0"
      matTooltip="local interest"
      matTooltipPosition="above"
      *ngIf="auth0Service.isAuthenticated$ | async"
    >
      local
      <mat-icon>mp</mat-icon>
    </button>
  </div>

  <hr />
</div>

<!-- End tab selection and point sort order -->

<!-- Points filter for tagPoints list or questionAnswers -->

<app-points-filter
  #pointsFilter
  [ShowFilters]="showFilters"
  [filter]="filter"
  (filterChange)="applyFilter()"
  (pointSortTypeChanged)="pointSortTypeChanged($event)"
  (cancelSearch)="cancelSearch()"
>
</app-points-filter>

<!-- End points filter -->

<!-- Begin Tab Content -->

<div class="tabContainer">
  <!-- 1 Tag Cloud -->
  <div class="tabContent" [ngClass]="{ topZ: tabIndex === Tabs.slashTags }">
    <div
      [ngClass]="{
        centerStage: tabIndex === Tabs.slashTags,
        stageLeft: tabIndex > Tabs.slashTags
      }"
    >
      <div class="scroller">
        <div class="content">
          <app-tag-cloud
            [HasFocus]="tabIndex === Tabs.slashTags"
            [forConstituency]="localData.ConstituencyID > 0"
            #slashTagsComponent
            (NewSlashTagSelected)="NewSlashTagSelected($event)"
          >
          </app-tag-cloud>
        </div>
      </div>
    </div>
  </div>

  <!-- 2 Question List -->
  <div class="tabContent" [ngClass]="{ topZ: tabIndex === Tabs.questionList }">
    <div
      [ngClass]="{
        centerStage: tabIndex === Tabs.questionList,
        stageLeft: tabIndex > Tabs.questionList,
        stageRight: tabIndex < Tabs.questionList
      }"
    >
      <!-- "Fetch more" component must apply scroller and content classes internally -->
      <app-questions-list
        #appQuestionsList
        [filter]="filter"
        [SortDescending]="filter.sortDescending"
        (QuestionCount)="QuestionCount($event)"
        (QuestionSelected)="QuestionSelected($event)"
      >
      </app-questions-list>
    </div>
  </div>

  <!-- 3 Question Answers -->
  <div
    class="tabContent"
    [ngClass]="{ topZ: tabIndex === Tabs.questionAnswers }"
  >
    <div
      [ngClass]="{
        centerStage: tabIndex === Tabs.questionAnswers,
        stageLeft: tabIndex > Tabs.questionAnswers,
        stageRight: tabIndex < Tabs.questionAnswers
      }"
    >
      <!-- "Fetch more" component must apply scroller and content classes internally -->
      <app-question-answers
        [filter]="filter"
        (ViewAllQuestions)="ViewAllQuestions()"
        #appQuestionAnswers
        (AnswerAdded)="AnswerAdded($event)"
        (AnswerRemoved)="AnswerRemoved($event)"
      >
      </app-question-answers>
    </div>
  </div>

  <!-- 4 app points for tag points. Scroller class NOT applied to tabContent. Scrollend has to fetch more points -->
  <div class="tabContent" [ngClass]="{ topZ: tabIndex === Tabs.tagPoints }">
    <div
      [ngClass]="{
        centerStage: tabIndex === Tabs.tagPoints,
        stageLeft: tabIndex > Tabs.tagPoints,
        stageRight: tabIndex < Tabs.tagPoints
      }"
    >
      <!-- "Fetch more" component must apply scroller and content classes internally -->
      <app-points-list
        #appPointsList
        [filter]="filter"
        [feedbackOn]="feedbackOn"
        (AltSlashTagSelected)="AltSlashTagSelected($event)"
      >
      </app-points-list>
    </div>
  </div>

  <!-- 5 new question or point -->
  <div class="tabContent" [ngClass]="{ topZ: tabIndex === Tabs.newPoint }">
    <div
      [ngClass]="{
        centerStage: tabIndex === Tabs.newPoint,
        stageRight: tabIndex < Tabs.newPoint
      }"
    >
      <div class="scroller">
        <div class="content mb-3">
          <h1 *ngIf="localData.forConstituency" class="h1Constituency">
            {{ localData.freeVoteProfile.constituency }}
          </h1>
          <app-question-edit
            #newQuestion
            *ngIf="showQuestions"
            [constituencyID]="filter.constituencyID"
            (CancelEdit)="CancelNewQuestion()"
            (CompleteEdit)="NewQuestion()"
          >
          </app-question-edit>

          <app-point-edit
            #newPoint
            *ngIf="!showQuestions"
            [constituencyID]="filter.constituencyID"
            (CancelEdit)="CancelNewPoint()"
            (CompleteEdit)="NewPointCreated()"
          >
          </app-point-edit>
        </div>
      </div>
    </div>
  </div>

  <!-- End Tab Container and Content -->
</div>

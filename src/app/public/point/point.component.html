<div *ngIf="!editing" class="point">
  <!-- Point Display -->
  <a [id]="'id' + point.pointID">
    <div
      [ngClass.xs]="'ugc xs'"
      [ngClass.sm]="'ugc sm'"
      [ngClass.gt-sm]="'ugc'"
    >
      <div fxLayout="row" fxLayoutAlign="start center">
        <div>
          <h1 [innerHtml]="point.pointTitle"></h1>
        </div>
        <div fxFlex></div>

        <!-- PointNumber/Count -->

        <div
          *ngIf="!sharing"
          class="aml-2 amr-2"
          [ngClass.xs]="'textXSmall'"
          [ngClass.sm]="'textSmall'"
          [ngClass.gt-sm]="'textMedium'"
        >
          {{ point.rowNumber }}/{{ pointCount }}
        </div>

        <!-- DateTimeUpdated -->

        <div
          [ngClass.xs]="'textXSmall'"
          [ngClass.sm]="'textSmall'"
          [ngClass.gt-sm]="'textMedium'"
          [innerHtml]="point.dateTimeUpdated | nbsp"
        ></div>
      </div>

      <hr *ngIf="!!point.pointTitle && !!point.pointHTML" class="hr hrTitle" />

      <div
        #elPointHtml
        [innerHTML]="pointHTMLwithoutEmbed | SafeHtml"
        [ngClass]="{ 'line-clamp': !showFullText }"
      ></div>

      <div class="moreorless">
        <a *ngIf="elementTruncated()" (click)="showMore(true)">show more</a>
        <a *ngIf="showFullText" (click)="showMore(false)">show less</a>
      </div>
    </div>
  </a>

  <!-- YouTube video -->

  <ng-container *ngIf="youTubeIDs.length > 0">
    <div *ngFor="let youTubeID of youTubeIDs" class="youTube">
      <iframe
        [src]="'https://www.youtube.com/embed/' + youTubeID | SafeURL"
        allowfullscreen
      ></iframe>
    </div>
  </ng-container>

  <!-- Vimeo video -->

  <ng-container *ngIf="vimeoIDs.length > 0">
    <div *ngFor="let vimeoID of vimeoIDs" class="youTube">
      <iframe
        [src]="'https://player.vimeo.com/video/' + vimeoID | SafeURL"
        frameborder="0"
        allowfullscreen
      ></iframe>
    </div>
  </ng-container>

  <!-- SoundCloud -->

  <ng-container class="youTube" *ngIf="soundCloudTrackIDs.length > 0">
    <div *ngFor="let soundCloudTrackID of soundCloudTrackIDs">
      <iframe
        [src]="
          'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/' +
            soundCloudTrackID +
            '&color=%23ff5500&auto_play=false&hide_related=true&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=true'
            | SafeURL
        "
      ></iframe>
    </div>
  </ng-container>

  <!-- Website link preview -->

  <div *ngIf="updatingPreview">
    <span class="spinner-grow text-primary ms-3 spinner" role="status">
      <span class="visually-hidden">Loading...</span>
    </span>
    updating link preview
  </div>

  <div
    *ngIf="
      point.pointFeedback.feedbackGiven ||
      point.showLinkPreview ||
      showLink ||
      point.isNewSource
    "
    class="pagePreview"
    [ngClass.lt-md]="'ltmd'"
  >
    <app-website-preview
      [ShowPreview]="point.showLinkPreview"
      [LinkAddress]="point.linkAddress"
      [Title]="point.linkTitle"
      [Description]="point.linkDescription"
      [Image]="point.linkImage"
      [NoPreviewText]="point.linkText"
    >
    </app-website-preview>
  </div>

  <div class="alert alert-danger" *ngIf="!!error">
    {{ error }}
  </div>

  <!-- Toolbar -->

  <div class="toolbar" fxLayout="row wrap" fxLayoutAlign="left center">
    <div *ngIf="possibleAnswer">
      <button
        mat-button
        (click)="AddToAnswers(point.pointID)"
        matTooltip="Add to answers"
      >
        <mat-icon>add_circle</mat-icon>
      </button>
    </div>

    <div *ngIf="isMyAnswer">
      <button
        mat-button
        (click)="RemoveFromAnswers(point.pointID)"
        matTooltip="Remove from answers"
      >
        <mat-icon>remove_circle</mat-icon>
      </button>
    </div>

    <div *ngIf="point.draft" fxFlex class="draft">Draft Only</div>

    <!-- SlashTags -->

    <div
      [ngClass.xs]="'textXSmall'"
      [ngClass.sm]="'textSmall'"
      [ngClass.gt-sm]="'textMedium'"
      class="py-2"
    >
      <span>
        <a
          *ngFor="let tag of tags"
          class="slashTag"
          (click)="setSlashTag(tag.slashTag)"
          >{{ tag.slashTag }}</a
        >
      </span>
    </div>

    <!-- Toolbar Remainder -->

    <div fxFlex fxLayout="row" fxLayoutAlign="end center">
      <app-point-types
        [pointTypeID]="point.pointTypeID"
        (PointTypeVote)="PointTypeVote($event)"
      ></app-point-types>

      <!-- Point Owner and Feedback Menu -->

      <div *ngIf="localData.LoggedInToAuth0">
        <!-- type='button' https://stackoverflow.com/questions/12319758/clicking-a-button-within-a-form-causes-page-refresh -->
        <!-- https://stackblitz.com/angular/rllvqdkjedar -->
        <button mat-button [matMenuTriggerFor]="pointCommands" type="button">
          <mat-icon
            *ngIf="!point.pointFeedback.feedbackIsUpdatable"
            matTooltip="anon feedback locked"
            >lock</mat-icon
          >

          <mat-icon
            *ngIf="
              point.pointFeedback.feedbackIsUpdatable &&
              !point.pointFeedback.supportLevelID
            "
            matTooltip="feedback options"
            >menu</mat-icon
          >

          <img
            src="./assets/Modified.png"
            *ngIf="point.pointFeedback.pointModified"
            matTooltip="Point has been updated. Please confirm your feedback."
          />
          <img
            src="./assets/Agree.png"
            *ngIf="
              !point.pointFeedback.pointModified &&
              point.pointFeedback.supportLevelID === 1
            "
            matTooltip="Upvoted"
          />
          <img
            src="./assets/Disagree.png"
            *ngIf="
              !point.pointFeedback.pointModified &&
              point.pointFeedback.supportLevelID === -8
            "
            matTooltip="Neutral"
          />
          <img
            src="./assets/Oppose.png"
            *ngIf="
              !point.pointFeedback.pointModified &&
              point.pointFeedback.supportLevelID === -1
            "
            matTooltip="Downvoted"
          />
          <img
            src="./assets/Block.png"
            *ngIf="
              !point.pointFeedback.pointModified &&
              point.pointFeedback.supportLevelID === -9
            "
            matTooltip="Blocked"
          />

          <mat-icon *ngIf="point.isFavourite" matTooltip="Is favourite"
            >favorite</mat-icon
          >
          <mat-icon *ngIf="point.isImportant" matTooltip="Is Important"
            >priority_high</mat-icon
          >
          <mat-icon *ngIf="point.localInterest" matTooltip="Local Interest"
            >mp</mat-icon
          >
          <mat-icon *ngIf="point.draft" matTooltip="draft point - not public"
            >visibility_off</mat-icon
          >
        </button>

        <!-- Voter Point Feedback Options -->

        <mat-menu #pointCommands="matMenu">
          <!-- Point Owner Commands -->

          <button mat-menu-item (click)="edit()" *ngIf="point.isPointOwner">
            <mat-icon>edit</mat-icon>
            edit
          </button>

          <button mat-menu-item (click)="delete()" *ngIf="point.isPointOwner">
            <mat-icon>delete_forever</mat-icon>
            delete
          </button>

          <hr class="hr" *ngIf="point.isPointOwner" />

          <!-- End Point Owner -->

          <button
            mat-menu-item
            (click)="Support()"
            *ngIf="point.pointFeedback.feedbackIsUpdatable"
            [ngClass]="{ selected: point.pointFeedback.supportLevelID === 1 }"
          >
            <img src="./assets/Agree.png" alt="Agree" /> up-vote
          </button>

          <button
            mat-menu-item
            (click)="Neutral()"
            *ngIf="point.pointFeedback.feedbackIsUpdatable"
            [ngClass]="{ selected: point.pointFeedback.supportLevelID === -8 }"
          >
            <img src="./assets/Disagree.png" alt="Neutral" /> neutral
          </button>

          <button
            mat-menu-item
            (click)="Oppose()"
            *ngIf="point.pointFeedback.feedbackIsUpdatable"
            [ngClass]="{ selected: point.pointFeedback.supportLevelID === -1 }"
          >
            <img src="./assets/Oppose.png" alt="Oppose" /> down-vote
          </button>

          <button
            mat-menu-item
            (click)="Report()"
            *ngIf="point.pointFeedback.feedbackIsUpdatable"
            [ngClass]="{ selected: point.pointFeedback.supportLevelID === -9 }"
          >
            <img src="./assets/Block.png" alt="Block" /> block
          </button>

          <button
            mat-menu-item
            (click)="OccupyHandSignals()"
            *ngIf="point.pointFeedback.feedbackIsUpdatable"
          >
            <img src="./assets/Clarify.png" alt="Clarify" /> view all signs
          </button>

          <hr class="hr" />

          <button
            mat-menu-item
            [ngClass]="{ selected: point.localInterest }"
            (click)="addLocalTags()"
          >
            <mat-icon matTooltip="make point local interest">mp</mat-icon>
            local interest
          </button>

          <button
            mat-menu-item
            (click)="favourite()"
            matTooltip="flag point as a favourite"
            [ngClass]="{ selected: point.isFavourite }"
          >
            <mat-icon>{{ favoriteIcon }}</mat-icon>
            favourite
          </button>

          <button
            mat-menu-item
            (click)="important()"
            matTooltip="flag point as important"
            [ngClass]="{ selected: point.isImportant }"
          >
            <mat-icon>priority_high</mat-icon>
            important
          </button>

          <hr class="hr" />

          <button
            mat-menu-item
            (click)="anon()"
            *ngIf="point.pointFeedback.feedbackIsUpdatable"
          >
            <mat-icon>lock</mat-icon>
            anonymous feedback
          </button>

          <button
            mat-menu-item
            *ngIf="point.pointFeedback.feedbackGiven"
            matTooltip="date feedback given"
          >
            <mat-icon>date_range</mat-icon>
            <span [innerHTML]="point.pointFeedback.feedbackDate | nbsp"></span>
          </button>
        </mat-menu>
      </div>

      <!-- Not already sharing -->
      <button
        *ngIf="!sharing"
        mat-button
        [routerLink]="linkShare"
        matTooltip="share and comment"
      >
        <mat-icon>comment</mat-icon>
        <span *ngIf="point.totalFeedback > 0">
          {{ point.totalFeedback }}
        </span>
      </button>

      <!-- Already sharing -->
      <button
        *ngIf="sharing"
        mat-button
        (click)="newComment()"
        matTooltip="new comment"
      >
        <mat-icon>comment</mat-icon>
        <span *ngIf="point.totalFeedback > 0">
          {{ point.totalFeedback }}
        </span>
      </button>
    </div>
    <!-- End Toolbar Remainder -->
  </div>
  <!-- End Toolbar -->
</div>
<!-- End Point Display -->

<!-- Removing the banana from the box [(point)] is not necessary - https://medium.com/@preethi.s/angular-custom-two-way-data-binding-3e618309d6c7 -->
<app-point-edit
  *ngIf="editing"
  [isPorQPoint]="isPorQPoint"
  [isMyAnswer]="isMyAnswer"
  [isComment]="isComment"
  (CancelEdit)="onCancelEdit()"
  (CompleteEdit)="onCompleteEdit()"
  [(point)]="point"
  [constituencyID]="constituencyID"
>
</app-point-edit>
